// Helper to extract shoe names from an assistant reply containing a SHOES_JSON block.

const SHOES_REGEX = /SHOES_JSON\s*:\s*(\{[\s\S]*?\})/i;

export function matchShoesFromReply(reply) {
  if (!reply) return [];
  const match = reply.match(SHOES_REGEX);
  if (!match) return [];
  try {
    const parsed = JSON.parse(match[1]);
    const recommended = Array.isArray(parsed?.recommendedShoes) ? parsed.recommendedShoes : [];
    return recommended
      .map((item) => {
        if (typeof item === 'string') return item.trim();
        if (item && typeof item.name === 'string') return item.name.trim();
        return '';
      })
      .filter(Boolean);
  } catch (err) {
    return [];
  }
}
